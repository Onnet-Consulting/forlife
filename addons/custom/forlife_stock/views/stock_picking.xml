<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="forlife_stock_stock_picking_tree_view" model="ir.ui.view">
        <field name="name">forlife.stock.stock.picking.tree.view</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.vpicktree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='scheduled_date']" position="after">
                <field name="date_done"/>
            </xpath>
            <xpath expr="//field[@name='location_dest_id']" position="after">
                <field name="total_purchase_qty"/>
                <field name="total_qty_done"/>
            </xpath>
            <xpath expr="//field[@name='date_done']" position="after">
                <field name="done_picking_uid"/>
            </xpath>
            <xpath expr="//field[@name='backorder_id']" position="attributes">
                <attribute name="string">Phần thiếu của</attribute>
            </xpath>
            <xpath expr="//field[@name='backorder_id']" position="after">
                <field name="leftovers_id"/>
            </xpath>
        </field>
    </record>
    <record id="forlife_stock_stock_picking_form_view" model="ir.ui.view">
        <field name="name">forlife.stock.stock.picking.form.view</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='owner_id']" position="after">
                <field name="create_from_po_inter_company" attrs="{'invisible': [('create_from_po_inter_company', '=', False)]}"/>
            </xpath>
            <!--            <xpath expr="//div[@name='button_box']" position="inside">-->
            <!--                <field name="is_need_scan_barcode" invisible="1"/>-->
            <!--                <button name="open_scan_barcode" type="object" icon="fa-barcode" attrs="{'invisible':['|', ('state', '!=', 'assigned'), ('is_need_scan_barcode', '=', False)]}">-->
            <!--                    <div class="o_field_widget o_stat_info">-->
            <!--                        <span class="o_stat_text">Quét Barcode</span>-->
            <!--                    </div>-->
            <!--                </button>-->
            <!--            </xpath>-->
            <xpath expr="//button[@name='button_validate'][1]" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('state', 'in', ('waiting','confirmed')), '|', ('show_validate', '=', False), ('is_pk_purchase', '=', True)]}</attribute>
            </xpath>
            <xpath expr="//button[@name='button_validate'][1]" position="attributes">
                <attribute name="context">{'check_date_done': 1}</attribute>
            </xpath>
            <xpath expr="//button[@name='button_validate'][1]" position="after">
                <field name="is_picking_return" invisible="1"/>
                <button name="button_forlife_validate" attrs="{'invisible': ['|', ('state', 'in', ('waiting','confirmed')), '|', ('show_validate', '=', False), ('is_pk_purchase', '!=', True)]}"
                        string="Xác nhận" type="object" class="oe_highlight" groups="stock.group_stock_user" context="{'check_date_done': 1}"/>
            </xpath>
            <xpath expr="//button[@name='%(stock.act_stock_return_picking)d']" position="attributes">
               <attribute name="attrs">{'invisible':['|', ('is_picking_return', '=', True), ('state', '!=', 'done')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='date_done']" position="replace">
                <field name="date_done"/>
            </xpath>
            <xpath expr="//field[@name='backorder_id']" position="after">
                <field name="leftovers_id" string="Phần thừa của" attrs="{'invisible': [('leftovers_id', '=', False)]}"/>
            </xpath>
            <xpath expr="//field[@name='origin']" position="before">
                <field name="relation_return" attrs="{'invisible': [('x_is_check_return', '=', False)]}"/>
                <field name="x_hide_return" invisible="1"/>
                <field name="x_is_check_return" invisible="1"/>
                <field name="check_inter_company" invisible="1"/>
            </xpath>

            <button name="action_cancel" position="after">
                <button name="create_order_inter_company" attrs="{'invisible': [('check_inter_company', '=', False)]}" string="Tạo đơn liên công ty" type="object" class="oe_highlight" groups="stock.group_stock_user"/>
                <button name="action_export" string="Xuất" type="object"/>
            </button>
        </field>
    </record>
    <record id="stock_picking_over_popup_view_form" model="ir.ui.view">
        <field name="name">stock.picking.over.popup.confirm.view.form</field>
        <field name="model">stock.picking.over.popup.confirm</field>
        <field name="arch" type="xml">
            <form>
                <p>Bạn đã nhập quá số lượng nhu cầu ban đầu! Bạn có muốn tạo phần dở dang thừa?</p>
                <field name="picking_id" invisible="1" force_save="1"/>
                <footer>
                    <button name="process" string="Tạo phần dở dang thừa" type="object" class="btn-primary"/>
                    <button string="Cancel" class="btn-secondary" special="cancel" />
                </footer>
            </form>
        </field>
    </record>
    <record id="stock_picking_over_less_popup_view_form" model="ir.ui.view">
        <field name="name">stock.picking.over.less.popup.confirm.view.form</field>
        <field name="model">stock.picking.over.popup.confirm</field>
        <field name="arch" type="xml">
            <form>
                <p>Bạn đã nhập khác số lượng nhu cầu ban đầu! Bạn có muốn tạo phần dở dang thừa và thiếu?</p>
                <field name="picking_id" invisible="1" force_save="1"/>
                <footer>
                    <button name="process" string="Tạo phần dở dang thừa/thiếu" type="object" class="btn-primary"/>
                    <button string="Cancel" class="btn-secondary" special="cancel" />
                </footer>
            </form>
        </field>
    </record>
    <record id="view_picking_internal_search_inherit" model="ir.ui.view">
        <field name="name">stock.picking.internal.search.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_internal_search"/>
        <field name="arch" type="xml">
            <filter name="activities_exception" position="after">
                <separator/>
                <filter name="my_confirm" string="Xác nhận bởi tôi" domain="[('done_picking_uid', '=', uid)]"/>
            </filter>
        </field>
    </record>

    <record id="stock.action_validate_picking" model="ir.actions.server">
        <field name="name">Validate</field>
        <field name="model_id" ref="stock.model_stock_picking"/>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            if records:
                res = records.check_date_done_before_validate()
                if isinstance(res, dict):
                    action = res
                else:
                    for r in records:
                        res = r.button_validate()
                        if isinstance(res, dict):
                            action = res
        </field>
    </record>
</odoo>