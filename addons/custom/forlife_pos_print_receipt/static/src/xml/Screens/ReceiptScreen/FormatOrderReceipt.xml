<?xml version="1.0" encoding="UTF-8" ?>
<templates id="template" xml:spce="preserve">

    <t t-name="OrderReceipt_Format" t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension" owl="1">
        <xpath expr="//div[hasclass('pos-receipt')]" position="after">
            <t t-if="env.pos.pos_brand_info.code == 'FMT'">
                <div class="pos-receipt">
                    <t t-call="FormatOrderReceipt"/>
                </div>
            </t>
        </xpath>
    </t>

    <t t-name="FormatOrderReceipt" owl="1">
        <t t-call="FormatOrderHeaderReceipt"/>
        <t t-call="FormatOrderLinesReceipt"/>
        <t t-call="FormatOrderPaymentLinesReceipt"/>
        <t t-call="FormatOrderFooterReceipt"/>
    </t>

    <t t-name="FormatOrderHeaderReceipt" owl="1">
        <div class="receipt-header">
            <img class="pos-receipt-logo format"
                 src="/forlife_pos_print_receipt/static/src/img/logo-format.png" height="25"/>
            <div class="store-address">
                <t t-if="env.pos.pos_store_info.address">
                    <div class="text-center">
                        <t t-esc="env.pos.pos_store_info.address"/>
                    </div>
                </t>
                <t t-if="env.pos.pos_store_info.phone">
                    <div class="text-center">
                        <t t-esc="env.pos.pos_store_info.phone"/>
                    </div>
                </t>
            </div>

            <table>
                <tbody>
                    <tr>
                        <td>Ngày giờ:</td>
                        <td>
                            <t t-esc="receipt.date.localestring1"/>
                        </td>
                    </tr>
                    <tr>
                        <td>Số hóa đơn:</td>
                        <td>
                            <t t-esc="receipt.name"/>
                        </td>
                    </tr>
                    <t t-if="receipt.partner">
                        <tr>
                            <td>Khách hàng:</td>
                            <td>
                                <t t-esc="receipt.partner.name"/>
                                -
                                <t t-esc="receipt.partner.phone || ''"/>
                            </td>
                        </tr>
                    </t>
                    <tr>
                        <td>Nhân viên:</td>
                        <td>
                            <t t-esc="receipt.cashier"/>
                        </td>
                    </tr>
                    <tr>
                        <td>Ghi chú:</td>
                        <td>
                            <t t-esc="receipt.note"/>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </t>

    <t t-name="FormatOrderLinesReceipt" owl="1">
        <div class="orderlines">
            <t t-call="SeparateLine"/>
            <table class="lines-detail">
                <tbody>
                    <tr>
                        <th class="num_1 text">Tên hàng</th>
                        <th class="num_2 number">SL</th>
                        <th class="num_3 number">ĐG</th>
                        <th class="num_4 number">GG</th>
                        <th class="num_5 number">Tổng tiền</th>
                    </tr>
                </tbody>
            </table>
            <t t-call="SeparateLine"/>

            <table class="lines-detail">
                <tbody>
                    <t t-if="receipt.normal_lines.length > 0">
                        <t t-foreach='receipt.normal_lines' t-as='line' t-key="line.id">
                            <t t-call="FormatOrderLinesDetailReceipt"/>
                        </t>
                    </t>

                    <t t-if="receipt.promotion_lines.length > 0">
                        <t t-foreach='receipt.promotion_lines' t-as='promotion_data'
                           t-key="promotion_data['lines'][0].id">
                            <t t-set="promotion_names" t-value="promotion_data['promotion_names']"/>
                            <t t-set="lines" t-value="promotion_data['lines']"/>
                            <t t-foreach="promotion_names" t-as="promotion_name" t-key="promotion_name">
                                <tr class="promotion-program-name">
                                    <td colspan="5">
                                        -
                                        <t t-esc="promotion_name"/>
                                    </td>
                                </tr>
                            </t>
                            <t t-foreach="lines" t-as="line" t-key="line.id">
                                <t t-call="FormatOrderLinesDetailReceipt"/>
                            </t>
                        </t>
                    </t>

                    <t t-if="receipt.applied_point_lines.length > 0">
                        <tr class="point-header">
                            <td colspan="5">
                                Tiêu tích lũy
                            </td>
                        </tr>
                        <t t-foreach="receipt.applied_point_lines" t-as="line" t-key="line.id">
                            <t t-call="FormatOrderLinesDetailReceipt"/>
                        </t>
                    </t>

                </tbody>
            </table>
        </div>
    </t>

    <t t-name="FormatOrderLinesDetailReceipt" owl="1">
        <t t-if="line.quantity != 0">
            <tr>
                <td colspan="5">
                    <t t-esc="line.product_name_wrapped[0]"/>
                </td>
            </tr>
            <tr class="product-price-qty-detail">
                <td class="num_1 text">
                    <t t-esc="line.product_default_code || ''"/>
                </td>
                <td class="num_2 number">
                    <t t-esc="line.quantity"/>
                </td>
                <td class="num_3 number">
                    <t t-esc="env.pos.format_currency_no_symbol(line.original_price)"/>
                </td>
                <td class="num_4 number">
                    <t t-esc="line.discount_percent"/>%
                </td>
                <td class="num_5 number">
                    <t t-esc="env.pos.format_currency_no_symbol(line.total_amount)"/>
                </td>
            </tr>
        </t>
    </t>

    <t t-name="FormatOrderPaymentLinesReceipt" owl="1">
        <t t-call="SeparateLine"/>

        <div class="payment_lines">
            <table class="payment-detail">
                <tbody>
                    <tr>
                        <td class="col1"/>
                        <td class="col2"/>
                        <td class="col3"/>
                        <td class="col4"/>
                        <td class="col5"/>
                    </tr>
                    <tr>
                        <td class="col1 text">Tổng cộng:</td>
                        <td class="col2 number">
                            <t t-esc="receipt.total_line_qty"/>
                        </td>
                        <td class="number" colspan="3">
                            <t t-esc="env.pos.format_currency_no_symbol(receipt.order_total)"/>
                        </td>
                    </tr>
                    <tr>
                        <td class="col1">Chiết khấu:</td>
                        <td colspan="4" class="text-right">
                            <t t-esc="env.pos.format_currency_no_symbol(receipt.order_total_discount)"/>
                        </td>
                    </tr>
                    <t t-if="Object.keys(receipt.applied_code_value).length > 0">
                        <t t-foreach="Object.entries(receipt.applied_code_value)" t-as="code_value"
                           t-key="code_value[0]">
                            <tr>
                                <td colspan="3" class="promotion-code">
                                    <t t-esc="code_value[0]"/>
                                </td>
                                <td colspan="2" class="text-right">
                                    <t t-esc="'(' + env.pos.format_currency_no_symbol(code_value[1]) + ')'"/>
                                </td>
                            </tr>
                        </t>
                    </t>

                    <t t-if="receipt.voucher_data">
                        <t t-foreach="receipt.voucher_data" t-as="voucher" t-key="voucher.code">
                            <tr>
                                <td colspan="3" class="promotion-code">
                                    <t t-esc="voucher.code"/>
                                </td>
                                <td colspan="2" class="text-right">
                                    <t t-esc="'(' + env.pos.format_currency_no_symbol(voucher.value) + ')'"/>
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>
            </table>

            <t t-call="SeparateLine"/>

            <table class="payment-detail">
                <tbody>
                    <tr>
                        <td colspan="2">Tổng tiền thanh toán:</td>
                        <td colspan="3" class="text-right">
                            <t t-esc="env.pos.format_currency_no_symbol(receipt.total_paid || 0)"/>
                        </td>
                    </tr>
                </tbody>
            </table>

            <table class="payment-line-detail">
                <tbody>
                    <t t-foreach='receipt.paymentlines' t-as='line' t-key="line_index">
                        <tr>
                            <td>
                                <t t-esc="line.name"/>
                            </td>
                            <td class="text-right">
                                <t t-esc="env.pos.format_currency_no_symbol(line.amount)"/>
                            </td>
                        </tr>
                    </t>
                    <t t-if="receipt.total_applied_points">
                        <tr>
                            <td>
                                Tiêu tích lũy
                            </td>
                            <td class="text-right">
                                <t t-esc="env.pos.format_currency_no_symbol(receipt.total_applied_points)"/>
                            </td>
                        </tr>
                    </t>
                </tbody>
            </table>

            <t t-call="SeparateLine"/>
        </div>
    </t>

    <t t-name="FormatOrderFooterReceipt" owl="1">
        <div class="receipt-footer">
            <div t-out="receipt.footer"/>
        </div>
    </t>

</templates>