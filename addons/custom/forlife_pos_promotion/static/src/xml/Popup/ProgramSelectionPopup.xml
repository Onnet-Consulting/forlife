<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <t t-name="ProgramSelectionPopup" owl="1">
        <div class="popup popup-text popup-med-custom product-configurator-popup">
            <header class="title">
                <t t-esc="'Chọn chương trình khuyến mãi'" />
            </header>
            <p style="margin: 10px 0 10px 0"><strong style="font-size: 20px;">Tổng giảm đã trên đơn: &nbsp;<t t-esc="this.env.pos.format_currency(state.discount_amount_order)"/></strong></p>
            <hr/>
            <main class="body product_configurator_attributes col-lg-4 col-md-6 col-sm-12">
                <ul>
                    <t t-foreach="props.programs" t-as="program" t-key="program.id">
                        <li class="program-item" t-att-class="program.forecastedNumber > 0 ? 'selectable' : ''">
                            <input type="checkbox" name="programs"
                                   t-att-id="program.id"
                                   t-att-value="program.id"
                                   t-on-click="() => this.selectItem(program.id)"
                                   t-att-checked="'checked' ? program.isSelected : ''"
                                   t-att-disabled="program.forecastedNumber ==0 ? 'selectable' : ''"
                            />
                            <label t-att-for="program.id">
                                <t t-esc="program.label"/>
                                <t t-if="program.isSelected and program.order_apply >= 0">
                                    <div style="display: inline-block" class="badge rounded-pill text-bg-success">
                                        <span style="padding-right: 20px; font-weight: 700" t-esc="program.index"/>
                                    </div>
                                </t>
                                <t t-if="program.codeObj">
                                    <div style="display: inline-block" class="badge rounded-pill text-bg-info">
                                        <span style="padding-right: 20px; font-weight: 700" t-esc="program.codeObj.code"/>
                                    </div>
                                </t>
                            </label>
                            <p t-if="program.reward_type == 'code_buy_x_get_y'" >
                                <label>Chọn sản phẩm tặng kèm:</label>
                                <select t-att-id="'reward_product_selected_'+program.id"
                                        t-on-click="(ev) => this.selectRewardProduct(ev.target.value, program.id)"
                                        style="margin-left: 2em;width: 70%;cursor: pointer;background-color: transparent;padding: 0.5em;color: #666666;font-size: 18px;margin-bottom: 0.5em;">
                                    <option t-att-value="0">--Chọn sản phẩm--</option>
                                    <option t-foreach="this.env.pos.get_valid_reward_code_promotion(program.program)"
                                            t-as="product_id" t-key="product_id" t-att-value="product_id"
                                            t-att-selected="program.program.reward_product_id_selected == product_id and 'selected' or ''">
                                        <t t-set="product" t-value="this.env.pos.db.get_product_by_id(product_id)"/>
                                        <t t-out="product.display_name"/>
                                    </option>
                                </select>
                            </p>
                            <p>
                                <div t-if="!program.isSelected" class="number-combo">Còn&nbsp;
                                    <t t-if="['code_buy_x_get_y', 'code_buy_x_get_cheapest'].includes(program.program.reward_type)">
                                        <strong><t t-esc="program.program.reward_quantity*(program.forecastedNumber or 0)"/></strong> &nbsp;SP tặng
                                    </t>
                                    <t t-else="">
                                        <strong t-esc="program.forecastedNumber or 0"/> &nbsp;Combo/SP
                                    </t>
                                </div>
                                <div t-if="program.isSelected" class="number-combo">Đã áp dụng&nbsp;
                                    <t t-if="['code_buy_x_get_y', 'code_buy_x_get_cheapest'].includes(program.program.reward_type)">
                                        <strong><t t-esc="program.program.reward_quantity*program.numberCombo"/></strong> &nbsp;SP tặng
                                    </t>
                                    <t t-else="">
                                        <strong t-esc="program.numberCombo or 0"/> &nbsp;Combo/SP
                                    </t>
                                </div>
                                <div t-if="(program.forecastedNumber &gt; 0) and !['code_buy_x_get_y', 'code_buy_x_get_cheapest'].includes(program.program.reward_type)"
                                     style="display: inline-block;" class="btn-primary">
                                    <i title="Chi tiết" class="fa fa-list" t-on-click="() => this.view_combo_details(program.id)"/>
                                </div>
                                <t t-if="program.isSelected and program.discounted_amount > 0">
                                    <div style="display: inline-block" >
                                    Số tiền đã giảm: <strong t-esc="this.env.pos.format_currency(program.discounted_amount)"/>
                                    </div>
                                </t>
                                <t t-if="!program.isSelected and program.forecasted_discounted_amount > 0">
                                    <div style="display: inline-block" >
                                    Dự kiến giảm: <strong t-esc="this.env.pos.format_currency(program.forecasted_discounted_amount)"/>
                                    </div>
                                </t>
                            </p>
                            <p t-if="program.reward_for_referring">
                                <div style="font-style: italic; color: blue">Bạn được tặng mã KM cho CT:
                                    <strong t-esc="program.codeObj.reward_program_name"/>
                                </div>
                            </p>
                        </li>
                    </t>
                </ul>
            </main>
            <footer class="footer">
                <div class="button highlight confirm" t-on-click="confirm">
                    Apply
                </div>
                    <div class="button cancel" t-on-click="cancel">
                        Cancel
                    </div>
            </footer>
        </div>
    </t>

</templates>
