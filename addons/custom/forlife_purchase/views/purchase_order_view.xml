<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="inherit_purchase_order_form_view" model="ir.ui.view">
            <field name="name">purchase.order.form</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header" position="attributes">
                    <attribute name="invisible">True</attribute>
                </xpath>
                <xpath expr="//header" position="after">
                    <header>
                        <button name="action_create_invoice" string="Create Invoice"
                                class="btn btn-primary ms-md-2" type="object"
                                attrs="{'invisible':['|',('is_inter_company', '=', True),('custom_state', 'in', ('draft','confirm','reject','cancel','close'))]}"/>
                        <button string="Submit" name="action_confirm"
                                type="object" attrs="{'invisible':[('custom_state', '!=', 'draft')]}"/>
                        <button string="Approved" name="action_approved"
                                type="object" attrs="{'invisible':[('custom_state', '!=', 'confirm')]}"/>
                        <button string="Reject" name="action_reject"
                                type="object" attrs="{'invisible':[ ('custom_state', '!=', 'confirm')]}"
                                groups="purchase_request.admin_purchase_request_group"/>
                        <button string="Cancel" name="action_cancel" type="object"
                                attrs="{'invisible': [('custom_state', 'in', ('close', 'approved'))]}"/>
                        <button string="Close" name="action_close" type="object"
                                attrs="{'invisible': [('custom_state', '!=', 'approved')]}"/>
                        <field name="custom_state" widget="statusbar"
                               statusbar_visible="draft,confirm,approved,reject,cancel,close" readonly="1"/>
                    </header>
                </xpath>
                <xpath expr="//notebook" position="inside">
                    <page string="Product Exchange Rate">
                        <field name="exchange_rate_line" widget="section_and_note_one2many">
                            <tree editable="bottom" class="width-hh width-first" create="0" delete="0">
                                <field name="product_id" readonly="1"/>
                                <field name="name" readonly="1"/>
                                <field name="usd_amount" readonly="1" invisible="1"/>
                                <field name="vnd_amount" readonly="1"/>
                                <field name="import_tax"/>
                                <field name="tax_amount" readonly="1"/>
                                <field name="special_consumption_tax"/>
                                <field name="special_consumption_tax_amount" readonly="1"/>
                                <field name="vat_tax"/>
                                <field name="vat_tax_amount" readonly="1"/>
<!--                                <field name="total_vnd_amount" readonly="1"/>-->
                                <field name="total_tax_amount" readonly="1"/>
                            </tree>
                        </field>
                    </page>
                    <page string="Product Cost" name="product_cost">
                        <field name="is_inter_company" invisible="1"/>
                        <field name="cost_line" widget="section_and_note_one2many">
                            <tree editable="bottom" class="width-hh width-first" create="0" delete="0">
                                <field name="product_id" readonly="1"/>
                                <field name="name" readonly="1"/>
                                <field name="usd_amount" readonly="1"/>
                                <field name="vnd_amount"/>
                                <field name="hidden_amount" invisible="1"/>
                                <field name="allocate"/>
                                <field name="amt_allocate" readonly="1"/>
                                <field name="total_vnd_amount" readonly="1"/>
                                <field name="total_amt_allocate" readonly="1"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='payment_term_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="before">
                    <field name="partner_domain" invisible="1"/>
                    <field name="partner_id" string="Nhà cung cấp" domain="partner_domain"/>
                    <field name="is_passersby" invisible="1"/>
                    <field name="purchase_type"/>
                     <field name="currency_id"/>
                    <field name="exchange_rate"/>
                    <field name="purchase_code"/>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="after">
                    <field name="active_manual_currency_rate" invisible="1"/>
                    <!--                    <field name="apply_manual_currency_exchange" invisible="1"/>-->
                    <field name="manual_currency_exchange_rate"
                           attrs="{'invisible': [('active_manual_currency_rate', '=', False)]}"/>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="before">
                    <field name="has_contract"/>
                    <field name="has_invoice"/>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="after">
                    <field name="payment_term_id"/>
                    <field name="receive_date"/>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="replace">
                    <field name="date_order" string="Order Date"/>
                </xpath>
                <xpath expr="//field[@name='tax_totals']" position="after">
                    <field name="trade_discount"/>
                    <field name="total_trade_discount"/>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree" position="replace">
                    <tree editable="bottom" class="width-hh">
                        <control>
                            <create name="add_product_control" string="Add a product"/>
                            <create name="add_section_control" string="Add a section"
                                    context="{'default_display_type': 'line_section'}"/>
                            <create name="add_note_control" string="Add a note"
                                    context="{'default_display_type': 'line_note'}"/>
                        </control>
                        <field name="is_passersby" invisible="1"/>
                        <field name="display_type" invisible="1"/>
                        <field name="currency_id" invisible="1"/>
                        <field name="state" invisible="1"/>
                        <field name="product_type" invisible="1"/>
                        <field name="product_uom_category_id" invisible="1"/>
                        <field name="invoice_lines" invisible="1"/>
                        <field name="sequence" widget="handle"/>
                        <field name="product_id"
                               context="{'supplier_id': parent.partner_id, 'purchase_type': parent.purchase_type}"
                               domain="[('detailed_type', '=', parent.purchase_type), ('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"/>
                        <field name="name"/>
                        <field name="product_type" string="Type"/>
                        <field name="asset_code"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'asset')]}"/>
                        <field name="asset_name"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'asset')]}"/>
                        <field name="free_good"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="purchase_quantity"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="purchase_uom"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="exchange_quantity"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="product_qty" attrs="{'readonly': [('parent.purchase_type', '=', 'product')]}"
                               force_save="1"/>
                        <field name="vendor_price"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': [('is_passersby', '=', False)]}"
                               force_save="1"/>
                        <field name="price_unit"
                               attrs="{'readonly': ['|', ('qty_invoiced', '!=', 0), ('parent.purchase_type', '=', 'product')]}"
                               force_save="1"/>
                        <field name="product_uom" readonly="1"/>
                        <field name="location_id"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="taxes_id" widget="many2many_tags"
                               domain="[('type_tax_use','=','purchase'), ('company_id', '=', parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                               context="{'default_type_tax_use': 'purchase', 'search_view_ref': 'account.account_tax_view_search'}"
                               options="{'no_create': True}"/>
                        <field name="price_tax"/>
                        <field name="discount_percent"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': [('readonly_discount_percent', '=', True)]}"
                               force_save="1"/>
                        <field name="discount"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': [('readonly_discount', '=', True)]}"
                               force_save="1"/>
                        <!--                    <field name="price_subtotal" string="Discounted Subtotal" widget="monetary"-->
                        <!--                           sum="discounted subtotal" optional="hide"/>-->
                        <field name="event_id" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"
                        />
                        <field name="production_id" string="Manufacturing Order"/>
                        <field name="billed"/>
                        <field name="account_analytic_id" string="Cost Center"/>
                        <field name="receive_date" string="Receive Date"/>
                        <field name="tolerance" string="Tolerance"/>
                        <field name="readonly_discount" invisible="1"/>
                        <field name="readonly_discount_percent" invisible="1"/>
                        <field name="date_planned" invisible="1" attrs="{'required': [('display_type', '=', False)]}"
                               force_save="1"/>
                        <field name="analytic_distribution" widget="analytic_distribution"
                               invisible="1"
                               groups="analytic.group_analytic_accounting"
                               options="{'product_field': 'product_id', 'business_domain': 'purchase_order'}"/>
                        <field name="qty_received_manual" invisible="1"/>
                        <field name="qty_received_method" invisible="1"/>
                        <field name="qty_received" string="Received"
                               attrs="{'column_invisible': [('parent.state', 'not in', ('purchase', 'done'))], 'readonly': [('qty_received_method', '!=', 'manual')]}"
                               invisible="1"/>
                        <field name="qty_invoiced" string="Billed"
                               attrs="{'column_invisible': [('parent.state', 'not in', ('purchase', 'done'))]}"
                               invisible="1"/>
                        <field name="product_packaging_qty"
                               attrs="{'invisible': ['|', ('product_id', '=', False), ('product_packaging_id', '=', False)]}"
                               groups="product.group_stock_packaging" invisible="1"/>
                        <field name="product_packaging_id" attrs="{'invisible': [('product_id', '=', False)]}"
                               context="{'default_product_id': product_id, 'tree_view_ref':'product.product_packaging_tree_view', 'form_view_ref':'product.product_packaging_form_view'}"
                               groups="product.group_stock_packaging" optional="show"/>
                        <button name="action_purchase_history" type="object" icon="fa-history" title="Purchase History"
                                attrs="{'invisible': [('id', '=', False)]}"/>
                        <field name="price_subtotal" widget="monetary"/>
                        <field name="price_total" invisible="1"/>
                        <field name="price_tax" invisible="1"/>
                        <field name="company_id" invisible="1"/>
                        <field name="request_purchases"/>
                    </tree>
                </xpath>
                <xpath expr="//field[@name='notes']" position="attributes">
                    <attribute name="attrs">{'readonly': [('state', 'in', ('done', 'approved'))]}</attribute>
                </xpath>
            </field>
        </record>
        <!-- Inherit purchase order tree view -->
        <record id="inherit_purchase_order_tree_view" model="ir.ui.view">
            <field name="name">purchase.order.tree.inherit</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_view_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='invoice_status']" position="before">
                    <field name="purchase_type" widget="badge"/>
                    <field name="custom_state" decoration-success="custom_state == 'approved'" widget="badge"/>
                </xpath>
                <xpath expr="//field[@name='invoice_status']" position="before">
                    <field name="inventory_status"/>
                    <field name="date_order"/>
                </xpath>
            </field>
        </record>
        <record id="action_purchase_order_is_inter_company" model="ir.actions.act_window">
            <field name="name">Purchase Order Inter Company</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('purchase.purchase_order_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('purchase.purchase_order_form')})]"/>
            <field name="domain">[('is_inter_company', '=', True)]</field>
            <field name="context">{'default_is_inter_company':True}
            </field>
        </record>
        <record id="action_purchase_order_not_inter_company" model="ir.actions.act_window">
            <field name="name">Purchase Order</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('purchase.purchase_order_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('purchase.purchase_order_form')})]"/>
            <field name="domain">[('is_inter_company', '=', False)]</field>
            <field name="context">{'default_is_inter_company':False}
            </field>
        </record>
        <!--        Menu Is Inter Company-->
        <menuitem id="menu_purchase_order_is_inter_company" parent="purchase.menu_procurement_management"
                  action="forlife_purchase.action_purchase_order_is_inter_company" name="Purchase Order Inter Company" sequence="1"/>
        <!--        Menu Not Inter Company-->
        <menuitem id="menu_purchase_order_not_inter_company" parent="purchase.menu_procurement_management"
                  action="forlife_purchase.action_purchase_order_not_inter_company" name="Purchase Order" sequence="2"/>

        <!--Inactive menu purchase order-->
        <menuitem id="purchase.menu_purchase_form_action" parent="purchase.menu_procurement_management" active="False"/>
        <!-- Inactive menu Request for quatation-->
        <menuitem id="purchase.menu_purchase_rfq" active="False"/>

    </data>
</odoo>