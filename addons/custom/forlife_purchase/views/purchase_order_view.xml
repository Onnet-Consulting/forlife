<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="inherit_purchase_order_form_view" model="ir.ui.view">
            <field name="name">purchase.order.form</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header" position="attributes">
                    <attribute name="invisible">True</attribute>
                </xpath>
                <xpath expr="//header" position="after">
                    <header>
                        <button name="action_create_invoice" string="Create Invoice"
                                class="btn btn-primary ms-md-2" type="object"
                                attrs="{'invisible':[('custom_state', 'in', ('draft','confirm','reject','cancel','close'))]}"/>
                        <button string="Submit" name="action_confirm"
                                type="object" attrs="{'invisible':[('custom_state', '!=', 'draft')]}"/>
                        <button string="Approved" name="action_approved"
                                type="object" attrs="{'invisible':[('custom_state', '!=', 'confirm')]}"/>
                        <button string="Reject" name="action_reject"
                                type="object" attrs="{'invisible':[ ('custom_state', '!=', 'confirm')]}"
                                groups="purchase_request.admin_purchase_request_group"/>
                        <button string="Cancel" name="action_cancel" type="object"
                                attrs="{'invisible': [('custom_state', 'in', ('close', 'approved'))]}"/>
                        <button string="Close" name="action_close" type="object"
                                attrs="{'invisible': [('custom_state', '!=', 'approved')]}"/>
                        <field name="custom_state" widget="statusbar"
                               statusbar_visible="draft,confirm,approved,reject,cancel,close" readonly="1"/>
                    </header>
                </xpath>
<!--                <xpath expr="//group[hasclass('oe_subtotal_footer')]" position="replace">-->
<!--                    <group>-->
<!--                        <group class="oe_subtotal_footer oe_right">-->
<!--                            <field name="amount_untaxed" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
<!--                            <field name="amount_tax" widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
<!--                            <field name="total_discount" widget='monetary' options="{'currency_field': 'currency_id'}"/>-->
<!--                            <div class="oe_subtotal_footer_separator oe_inline">-->
<!--                                <label for="amount_total"/>-->
<!--                            </div>-->
<!--                            <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator"-->
<!--                                   widget="monetary" options="{'currency_field': 'currency_id'}"/>-->
<!--                        </group>-->
<!--                    </group>-->
<!--                </xpath>-->
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="prod_filter" invisible="1"/>
                    <field name="purchase_type"/>
                    <field name="purchase_code"/>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="after">
                    <field name="active_manual_currency_rate" invisible="1"/>
<!--                    <field name="apply_manual_currency_exchange" invisible="1"/>-->
                    <field name="manual_currency_exchange_rate"
                           attrs="{'invisible': [('active_manual_currency_rate', '=', False)]}"/>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="before">
                    <!--                    <field name="purchase_description"/>-->
                    <field name="inventory_status"/>
                    <field name="has_contract"/>
                    <field name="has_invoice"/>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree" position="replace">
                    <tree editable="bottom" class="width-hh">
                        <control>
                            <create name="add_product_control" string="Add a product"/>
                            <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>
                            <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
                        </control>
                        <field name="display_type" invisible="1"/>
                        <field name="currency_id" invisible="1"/>
                        <field name="state" invisible="1"/>
                        <field name="product_type" invisible="1"/>
                        <field name="product_uom_category_id" invisible="1"/>
                        <field name="invoice_lines" invisible="1"/>
                        <field name="sequence" widget="handle"/>
                        <field name="product_id" context="{'supplier_id': parent.partner_id, 'prod_filter': parent.prod_filter}"
                               domain="[('detailed_type', '=', parent.purchase_type), ('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"/>
                        <field name="name"/>
                        <field name="product_type" string="Type"/>
                        <field name="asset_code" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'asset')]}"/>
                        <field name="asset_name" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'asset')]}"/>
                        <field name="free_good" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="purchase_quantity"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="purchase_uom"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="exchange_quantity"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="product_qty" attrs="{'readonly': [('parent.purchase_type', '=', 'product')]}" force_save="1"/>
                        <field name="vendor_price"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}" readonly="1" force_save="1"/>
                        <field name="price_unit" attrs="{'readonly': ['|', ('qty_invoiced', '!=', 0), ('parent.purchase_type', '=', 'product')]}" force_save="1"/>
                        <field name="product_uom" readonly="1"/>
                        <field name="warehouses_id"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="taxes_id" widget="many2many_tags"
                               domain="[('type_tax_use','=','purchase'), ('company_id', '=', parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                               context="{'default_type_tax_use': 'purchase', 'search_view_ref': 'account.account_tax_view_search'}"
                               options="{'no_create': True}"/>
                        <field name="price_tax"/>
                        <field name="discount_percent" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': [('readonly_discount_percent', '=', True)]}" force_save="1"/>
                        <field name="discount" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': [('readonly_discount', '=', True)]}" force_save="1"/>
    <!--                    <field name="price_subtotal" string="Discounted Subtotal" widget="monetary"-->
    <!--                           sum="discounted subtotal" optional="hide"/>-->
                        <field name="event_id" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"
                               />
                        <field name="production_id" string="Manufacturing Order" attrs="{'column_invisible': [('parent.purchase_type', '=', 'service')]}"/>
                        <field name="account_analytic_id" string="Cost Center"/>
                        <field name="readonly_discount" invisible="1"/>
                        <field name="readonly_discount_percent" invisible="1"/>
                        <field name="date_planned" invisible="1" attrs="{'required': [('display_type', '=', False)]}" force_save="1"/>
                        <field name="analytic_distribution" widget="analytic_distribution"
                               invisible="1"
                               groups="analytic.group_analytic_accounting"
                               options="{'product_field': 'product_id', 'business_domain': 'purchase_order'}"/>
                        <field name="qty_received_manual" invisible="1"/>
                        <field name="qty_received_method" invisible="1"/>
                        <field name="qty_received" string="Received" attrs="{'column_invisible': [('parent.state', 'not in', ('purchase', 'done'))], 'readonly': [('qty_received_method', '!=', 'manual')]}" invisible="1"/>
                        <field name="qty_invoiced" string="Billed" attrs="{'column_invisible': [('parent.state', 'not in', ('purchase', 'done'))]}" invisible="1"/>
                        <field name="product_packaging_qty" attrs="{'invisible': ['|', ('product_id', '=', False), ('product_packaging_id', '=', False)]}" groups="product.group_stock_packaging" invisible="1"/>
                        <field name="product_packaging_id" attrs="{'invisible': [('product_id', '=', False)]}" context="{'default_product_id': product_id, 'tree_view_ref':'product.product_packaging_tree_view', 'form_view_ref':'product.product_packaging_form_view'}" groups="product.group_stock_packaging" optional="show"/>
                        <button name="action_purchase_history" type="object" icon="fa-history" title="Purchase History" attrs="{'invisible': [('id', '=', False)]}"/>
                        <field name="price_subtotal" widget="monetary"/>
                        <field name="price_total" invisible="1"/>
                        <field name="price_tax" invisible="1"/>
                    </tree>
                </xpath>
                <xpath expr="//field[@name='notes']" position="attributes">
                    <attribute name="attrs">{'readonly': [('state', 'in', ('done', 'approved'))]}</attribute>
                </xpath>
            </field>
        </record>
        <!-- Inherit purchase order tree view -->
        <record id="inherit_purchase_order_tree_view" model="ir.ui.view">
            <field name="name">purchase.order.tree.inherit</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_view_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='invoice_status']" position="before">
                    <field name="purchase_type" widget="badge"/>
                    <field name="custom_state" decoration-success="custom_state == 'approved'" widget="badge"/>
                </xpath>
                <xpath expr="//field[@name='invoice_status']" position="before">
                     <field name="date_order"/>
                </xpath>
            </field>
        </record>
        <!-- Inherit menu purchase order, show all row with all order status -->
        <record id="purchase.purchase_form_action" model="ir.actions.act_window">
            <field name="domain">[]</field>
        </record>
        <!-- Inactive menu Request for quatation-->
        <menuitem id="purchase.menu_purchase_rfq" active="False"/>

    </data>
</odoo>