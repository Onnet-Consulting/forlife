<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="inherit_purchase_order_form_view" model="ir.ui.view">
            <field name="name">purchase.order.form</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//div[@name='date_planned_div']" position="after">
                    <field name="create_from_picking" attrs="{'invisible': [('create_from_picking', '=', False)]}"/>
                </xpath>
                <xpath expr="//div[hasclass('oe_button_box')]/button[@name='action_view_invoice']" position="attributes">
                         <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//div[hasclass('oe_button_box')]/button[@name='action_view_picking']" position="before">
                    <button name="open_update_tax_and_cost" icon="fa-cogs" type="object" string="Thuế/Phí" title="Cập nhật thuế - chi phí"
                            groups="forlife_purchase.update_tax_and_cost_group"/>
                    <button name="action_view_invoice_ncc"
                        string="Invoice"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-pencil-square-o"
                        attrs="{'invisible': ['|', ('is_inter_company', '=', False), ('count_invoice_inter_company_ncc', '=', 0)]}">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="count_invoice_inter_company_ncc"/>
                            </span>
                            <span class="o_stat_text">Hóa đơn nhà cung cấp</span>
                        </div>
                    </button>
                    <button name="action_view_invoice_normal_new"
                        string="Bình thường"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-pencil-square-o"
                        attrs="{'invisible': [('count_invoice_inter_normal_fix', '=', 0)]}">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="count_invoice_inter_normal_fix"/>
                            </span>
                            <span class="o_stat_text">Hàng hóa dịch vụ tài sản</span>
                        </div>
                    </button>
                    <button name="action_view_invoice_expense_new"
                        string="Chi phí"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-pencil-square-o"
                        attrs="{'invisible': [('count_invoice_inter_expense_fix', '=', 0)]}">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="count_invoice_inter_expense_fix"/>
                            </span>
                            <span class="o_stat_text">Chi phí</span>
                        </div>
                    </button>
                    <button name="action_view_invoice_labor_new"
                        string="Nhân công"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-pencil-square-o"
                        attrs="{'invisible': [('count_invoice_inter_labor_fix', '=', 0)]}">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="count_invoice_inter_labor_fix"/>
                            </span>
                            <span class="o_stat_text">Nhân công</span>
                        </div>
                    </button>
                    <button
                            class="oe_stat_button" name="action_view_picking_inter_company"
                            type="object" icon="fa-truck"
                            attrs="{'invisible': ['|', ('is_inter_company', '=', False), ('count_delivery_inter_company', '=', 0)]}">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="count_delivery_inter_company"/>
                            </span>
                            <span class="o_stat_text">Xuất hàng</span>
                        </div>
                    </button>
                    <button
                            class="oe_stat_button" name="action_view_import_picking_inter_company"
                            type="object" icon="fa-truck"
                            attrs="{'invisible': ['|', ('is_inter_company', '=', False), ('count_delivery_inter_company', '=', 0)]}">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_value">
                                <field name="count_delivery_import_inter_company"/>
                            </span>
                            <span class="o_stat_text">Nhập hàng</span>
                        </div>
                    </button>
                </xpath>
                <xpath expr="//header" position="attributes">
                    <attribute name="invisible">True</attribute>
                </xpath>
                <xpath expr="//page[@name='purchase_delivery_invoice']" position="attributes">
                    <attribute name="invisible">True</attribute>
                </xpath>
                <xpath expr="//header" position="after">
                    <header>
                        <button string="TẠO HÓA ĐƠN"
                                class="btn btn-primary ms-md-2"
                                name="%(forlife_purchase.action_select_type_invoice_wizard)d"
                                type="action"
                                attrs="{'invisible':['|',('is_inter_company', '=', True),'&amp;',('is_done_picking', '=', False),'|',('purchase_type', '=', 'product'),('custom_state', 'in', ('draft','confirm','reject','cancel','close'))]}"/>
                        <button string="Gửi duyệt" name="action_confirm"
                                type="object" attrs="{'invisible':[('custom_state', '!=', 'draft')]}"/>
                        <button string="Approved" name="action_approved"
                                type="object" attrs="{'invisible':[('custom_state', '!=', 'confirm')]}"/>
                        <button string="Reject" name="%(forlife_purchase.reject_order_wizard)d"
                                type="action" attrs="{'invisible':[ ('custom_state', '!=', 'confirm')]}"
                                groups="purchase_request.admin_purchase_request_group" />
<!--                        <button string="Cancel (alpha)" name="action_cancel" type="object"-->
<!--                                attrs="{'invisible': [('custom_state', 'in', ('close', 'approved'))]}"/>-->
                        <button string="Cancel" name="%(forlife_purchase.cancel_order_wizard)d"
                                type="action" attrs="{'invisible': [('custom_state', 'in', ('cancel', 'close', 'approved'))]}"/>
                        <button string="Close" name="action_close" type="object"
                                attrs="{'invisible': [('custom_state', '!=', 'approved')]}"/>
                        <field name="custom_state" widget="statusbar"
                               statusbar_visible="draft,confirm,approved,reject,cancel,close" readonly="1"/>
                    </header>
                </xpath>
                <xpath expr="//notebook" position="inside">
                    <field name="type_po_cost" invisible="1"/>
                    <page string="Product Exchange Rate" attrs="{'invisible': [('type_po_cost', '!=', 'tax')]}">
                        <field name="exchange_rate_line_ids" attrs="{'readonly': [('custom_state', 'not in', ('draft'))]}" widget="section_and_note_one2many" force_save="1" string="Thuế nhập khẩu">
                            <tree editable="bottom" class="width-hh" create="0" delete="0">
                                <field name="company_currency" invisible="1"/>
                                <field name="product_id" readonly="1"/>
                                <field name="description" readonly="1"/>
                                <field name="company_currency" invisible="1"/>
                                <field name="total_vnd_exchange" sum="total_vnd_exchange" readonly="1" widget="monetary" options="{'currency_field': 'company_currency'}" force_save="1"/>
                                <field name="total_vnd_exchange_import" invisible="1"/>
                                <field name="product_qty" readonly="1" string="Số lượng"/>
                                <field name="import_tax"/>
                                <field name="tax_amount" sum="tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                <field name="tax_amount_import" invisible="1"/>
                                <field name="special_consumption_tax"/>
                                <field name="special_consumption_tax_amount" sum="special_consumption_tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                <field name="special_consumption_tax_amount_import" invisible="1"/>
                                <field name="vat_tax"/>
                                <field name="vat_tax_amount" sum="vat_tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                <field name="vat_tax_amount_import" invisible="1"/>
                                <field name="total_tax_amount" sum="total_tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}" readonly="1"/>
                            </tree>
                        </field>
                    </page>
                    <page string="Product Cost" name="product_cost" attrs="{'invisible': [('is_inter_company', '=', True)]}">
                        <field name="is_inter_company" invisible="1"/>
                        <field name="cost_line" widget="section_and_note_one2many" mode="tree" attrs="{'readonly': [('custom_state', 'not in', ('draft'))]}">
                            <tree editable="bottom" class="width-hh">
                                <field name="company_currency" invisible="1"/>
                                <field name="product_id"/>
                                <field name="name" readonly="1" string='Mô tả'/>
                                <field name="currency_id"/>
                                <field name="exchange_rate" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="foreign_amount"/>
                                <field name="vnd_amount" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                <field name="actual_cost" widget="monetary" options="{'currency_field': 'currency_id'}" invisible="1" readonly="1" force_save="1"/>
                                <field name="cost_paid" widget="monetary" options="{'currency_field': 'currency_id'}" readonly="1" force_save="1"/>
                                <field name="is_check_pre_tax_costs"/>
                            </tree>
                        </field>
                        <div class="xl-12 d-flex" style="justify-content: end;">
                            <group class="xl-4">
                            </group>
                              <group class="xl-4">
                            </group>
                              <group class="xl-4">
                                <field name="cost_total"/>
                            </group>
                        </div>
                    </page>
                    <page string="Tổng hợp" name="synthetic">
                        <field name="purchase_synthetic_ids" widget="section_and_note_one2many" mode="tree" readonly="1" force_save="1">
                            <tree editable="bottom" class="width-hh">
                                <field name="currency_id" invisible="1"/>
                                <field name="company_currency" invisible="1"/>
                                <field name="product_id"/>
                                <field name="description"/>
                                <field name="product_uom" string="Đơn vị tính"/>
                                <field name="price_unit" string="Đơn giá" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="product_qty" sum="discounted subtotal" string="Số lượng"/>
                                <!-- <field name="company_currency" invisible="1"/> -->
                                <field name="discount"/>
                                <field name="total_vnd_amount" widget="monetary" options="{'currency_field': 'company_currency'}" sum="total_vnd_amount"/>
                                <field name="before_tax" sum="before_tax" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                <field name="tax_amount" sum="tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}" attrs="{'column_invisible': [('parent.type_po_cost', '=', 'cost')]}"/>
                                <field name="special_consumption_tax_amount" sum="special_consumption_tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}" attrs="{'column_invisible': [('parent.type_po_cost', '=', 'cost')]}"/>
                                <field name="after_tax" widget="monetary" sum="after_tax" options="{'currency_field': 'company_currency'}"/>
                                <field name="total_product" sum="total_product" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='payment_term_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='date_approve']" position="attributes">
                    <attribute name="readonly">'custom_state' not in ('draft', 'confirm') </attribute>
                </xpath>
                <xpath expr="//field[@name='user_id']" position="attributes">
                    <attribute name="readonly">'custom_state' not in ('draft', 'confirm') </attribute>
                </xpath>
                <xpath expr="//field[@name='origin']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='incoterm_id']" position="attributes">
                    <attribute name="readonly">'custom_state' not in ('draft', 'confirm') </attribute>
                </xpath>
                <xpath expr="//field[@name='incoterm_location']" position="attributes">
                     <attribute name="readonly">'custom_state' not in ('draft', 'confirm') </attribute>
                </xpath>
                 <xpath expr="//field[@name='incoterm_location']" position="attributes">
                    <attribute name="string">Vị trí Incoterm</attribute>
                </xpath>
                <xpath expr="//field[@name='receipt_status']" position="attributes">
                    <attribute name="string">Trạng thái biên nhận</attribute>
                </xpath>
                <xpath expr="//field[@name='fiscal_position_id']" position="attributes">
                     <attribute name="readonly">'custom_state' not in ('draft', 'confirm') </attribute>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="before">
                    <field name="is_purchase_request" attrs="{'invisible': True}"/>
                    <field name="is_check_readonly_partner_id" attrs="{'invisible': True}"/>
                    <field name="is_check_readonly_purchase_type" attrs="{'invisible': True}"/>
                    <field name="partner_domain" invisible="1" />
                    <field name="partner_id" string="Nhà cung cấp"
                           attrs="{'readonly': ['|',('is_check_readonly_partner_id', '=', True), ('custom_state', 'not in', ('draft', 'confirm'))]}"
                           domain="[('is_purchase_inter_company', '=', is_inter_company), ('company_id', '=', False), ('group_id.code', 'not in', ['C', False])]" force_save="1" on_change="1"/>
                    <field name="is_passersby" invisible="1"/>
                    <field name="purchase_type" required="1" attrs="{'readonly': ['|',('is_check_readonly_purchase_type', '=', True),('custom_state', 'not in', ('draft', 'confirm'))]}"/>
                    <field name="currency_id" required="1"
                           attrs="{'readonly': [('custom_state', 'not in', ('draft', 'confirm'))]}"/>
                    <field name="exchange_rate" attrs="{'readonly': ['|',('custom_state', 'not in', ('draft', 'confirm')), ('type_po_cost', '=', 'cost')]}" force_save="1"/>
                    <field name="purchase_code" attrs="{'readonly': [('custom_state', 'not in', ('draft', 'confirm'))]}"/>
                    <field name="invoice_status"/>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="after">
                    <field name="active_manual_currency_rate" invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="before">
                    <field name="has_contract"/>
                    <field name="has_invoice"/>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="after">
                    <field name="payment_term_id" string="Chính sách thanh toán" attrs="{'readonly': [('custom_state', 'not in', ('draft', 'confirm'))]}"/>
                    <field name="receive_date" required="1" attrs="{'readonly': [('custom_state', 'not in', ('draft', 'confirm'))]}"/>
                </xpath>
                <xpath expr="//field[@name='date_planned']" position="replace">
                    <field name="date_planned" required="1" string="Hạn xử lý" attrs="{'readonly': [('custom_state', 'not in', ('draft', 'confirm'))]}"
                           force_save="1"/>
                    <field name="date_planned_import" string='Hạn xử lý' invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="replace">
                    <field name="date_order" required="1" string="Order Date" attrs="{'readonly': [('custom_state', 'not in', ('draft', 'confirm'))]}"/>
                </xpath>
                <xpath expr="//field[@name='tax_totals']" position="after">
                    <field name="trade_discount" attrs="{'readonly': [('custom_state', 'in', ('approved', 'confirm'))]}" force_save="1"/>
                    <field name="total_trade_discount" attrs="{'readonly': [('custom_state', 'in', ('approved', 'confirm'))]}" force_save="1"/>
                    <field name="trade_tax_id" attrs="{'readonly': [('custom_state', 'in', ('approved', 'confirm'))]}" force_save="1"/>
                    <field name="x_tax" attrs="{'readonly': [('custom_state', 'in', ('approved', 'confirm'))]}" force_save="1" invisible="1"/>
                    <field name="x_amount_tax" attrs="{'readonly': [('custom_state', 'in', ('approved', 'confirm'))]}" force_save="1"/>
                    <field name="is_done_picking" invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree" position="replace">
                    <tree editable="bottom" class="width-hh">
                        <control>
                            <create name="add_product_control" string="Thêm 1 dòng"/>
                        </control>
                        <field name="is_change_vendor" invisible="1"/>
                        <field name="is_red_color" invisible="1"/>
                        <field name="display_type" invisible="1"/>
                        <field name="currency_id" invisible="1"/>
                        <field name="state" invisible="1"/>
                        <field name="product_type" invisible="1"/>
                        <field name="product_uom_category_id" invisible="1"/>
                        <field name="invoice_lines" invisible="1"/>
                        <field name="sequence" widget="handle"/>
                        <field name="asset_code"
                               string="Thẻ tài sản"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'asset')], 'readonly': [('parent.custom_state', '=', 'approved')]}"/>
                        <field name="asset_name"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'asset')], 'readonly': [('parent.custom_state', '=', 'approved')]}"/>
                        <field name="product_id"
                               context="{'supplier_id': parent.partner_id, 'company_id': parent.company_id, 'purchase_type': parent.purchase_type, 'is_passersby': parent.is_passersby, 'type_po_cost': parent.type_po_cost}"
                               attrs="{'readonly': [('parent.custom_state', '=', 'approved')]}"
                               domain="[('product_type', '=', parent.purchase_type), ('purchase_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]" force_save="1"/>
                        <field name="name" invisible="1"/>
                        <field name="description" attrs="{'readonly': [('parent.custom_state', '=', 'approved')]}"/>
                        <field name="product_uom" readonly="1" attrs="{'column_invisible': [('parent.purchase_type', '=', 'asset')], 'readonly': [('parent.custom_state', '=', 'approved')]}" force_save="1" string="Đơn vị tính"/>
                        <field name="purchase_uom" attrs="{'readonly': [('parent.custom_state', '=', 'approved')]}"/>
                        <field name="exchange_quantity" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': [('parent.custom_state', '=', 'approved')]}" decoration-danger="is_red_color == True" string="Tỷ lệ quy đổi" force_save="1"/>
                        <field name="purchase_quantity" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': [('parent.custom_state', '=', 'approved')]}"/>
                        <field name="product_type" string="Type" attrs="{'readonly': [('parent.custom_state', '=', 'approved')]}"/>/>
                        <field name="request_purchases" attrs="{'readonly': [('parent.custom_state', '=', 'approved')]}"/>/>
                        <field name="free_good" attrs="{'readonly': [('parent.custom_state', '=', 'approved')]}"/>
                        <field name="product_qty"
                               attrs="{'readonly': ['|',('parent.purchase_type', '=', 'product'),('parent.custom_state', '=', 'approved')]}"
                               sum="discounted subtotal"
                               force_save="1"
                               string="Số lượng"/>
                        <field name="vendor_price"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': ['|', ('parent.custom_state', '=', 'approved'), '|', ('parent.is_passersby', '=', False), ('free_good', '=', True)]}"
                               force_save="1"/>
                        <field name="vendor_price_import"
                               string='Giá của nhà cung cấp'
                               invisible="1"/>
                        <field name="price_unit"
                               string="Đơn giá"
                               attrs="{'readonly': ['|', ('billed', '!=', 0), ('parent.purchase_type', '=', 'product')]}"
                               force_save="1"/>
                        <field name="product_uom" readonly="1" attrs="{'column_invisible': [('parent.purchase_type', '=', 'asset')], 'readonly': [('parent.custom_state', '=', 'approved')]}" force_save="1" string="Đơn vị tính"/>
                        <field name="location_id"
                               domain="[('usage','!=','view')]"
                               force_save="1"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': [('parent.custom_state', '=', 'approved')], 'required': [('parent.purchase_type', '=', 'product')]}"/>
                        <field name="taxes_id" widget="many2many_tags"
                               domain="[('type_tax_use','=','purchase'), ('company_id', '=', parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                               context="{'default_type_tax_use': 'purchase', 'search_view_ref': 'account.account_tax_view_search'}"
                               options="{'no_create': True}" string="Thuế(%)"
                               attrs="{'column_invisible': [('parent.type_po_cost', '=', 'tax')]}"
                        />
                        <field name="price_tax" string="Thuế" attrs="{'column_invisible': [('parent.type_po_cost', '=', 'tax')], 'readonly': [('parent.custom_state', '=', 'approved')]}"/>
                        <field name="price_subtotal"
                               widget="monetary"
                               sum="discounted subtotal"
                               force_save="1"
                               readonly="0"/>
                        <field name="company_currency" invisible="1"/>
                        <field name="total_vnd_amount"
                               widget="monetary" options="{'currency_field': 'company_currency'}"
                               sum="discounted subtotal"
                               force_save="1"
                               attrs="{'column_invisible': [('parent.type_po_cost', '=', 'cost')]}"
                               readonly="1"/>
                        <field name="discount_percent"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': ['|',('readonly_discount_percent', '=', True), ('parent.custom_state', '=', 'approved')]}"
                               force_save="1"/>
                        <field name="discount"
                               widget="monetary"
                               attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': ['|',('readonly_discount', '=', True), ('parent.custom_state', '=', 'approved')]}"
                               force_save="1"/>
                        <field name="occasion_code_id" string="Mã vụ việc" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')], 'readonly': [('parent.custom_state', '=', 'approved')]}"/>
                        <field name="prefix_product_code" invisible="1"/>
                        <field name="production_id" string="Manufacturing Order" attrs="{'readonly': [('parent.custom_state', '=', 'approved')],'required': [('prefix_product_code', 'in', ['A','E','F'])]}"/>
                        <field name="account_analytic_id" string="Cost Center" attrs="{'readonly': [('parent.custom_state', '=', 'approved')],'required': [('parent.purchase_type', '=', 'service')]}"/>
                        <field name="receive_date" string="Receive Date" attrs="{'column_invisible': [('parent.purchase_type', '!=', 'product')]}"/>
                        <field name="received" attrs="{'column_invisible': ['|',('received', '=', False),('parent.purchase_type', '!=', 'product')]}" sum="discounted subtotal" force_save="1"/>
                        <field name="readonly_discount" invisible="1"/>
                        <field name="readonly_discount_percent" invisible="1"/>
                        <field name="date_planned" invisible="1" attrs="{'required': [('display_type', '=', False)]}" force_save="1"/>
                        <field name="analytic_distribution" widget="analytic_distribution"
                               invisible="1" groups="analytic.group_analytic_accounting"
                               options="{'product_field': 'product_id', 'business_domain': 'purchase_order'}"/>
                        <field name="qty_received_manual" invisible="1"/>
                        <field name="qty_received_method" invisible="1"/>
                        <field name="received" string="Đã nhận"
                               attrs="{'column_invisible': [('parent.state', 'not in', ('purchase', 'done'))], 'readonly': [('qty_received_method', '!=', 'manual')]}"
                               invisible="0"/>
                        <field name="billed" string="Billed" attrs="{'column_invisible': [('parent.state', 'not in', ('purchase', 'done'))]}" invisible="0"/>
                        <button name="action_purchase_history" type="object" icon="fa-history" title="Purchase History" attrs="{'invisible': [('id', '=', False)]}"/>
                        <field name="price_total" invisible="1"/>
                        <field name="price_tax" invisible="1"/>
                        <field name="company_id" invisible="1"/>
                        <field name="total_vnd_exchange" invisible="1"/>
                        <field name="import_tax" invisible="1"/>
                        <field name="tax_amount" invisible="1"/>
                        <field name="special_consumption_tax" invisible="1"/>
                        <field name="special_consumption_tax_amount" invisible="1"/>
                        <field name="vat_tax" invisible="1"/>
                        <field name="vat_tax_amount" invisible="1"/>
                        <field name="total_tax_amount" invisible="1"/>
                        <field name="before_tax" invisible="1"/>
                        <field name="after_tax" invisible="1"/>
                        <field name="total_product" invisible="1"/>
                    </tree>
                </xpath>
                <xpath expr="//field[@name='notes']" position="attributes">
                    <attribute name="attrs">{'readonly': [('state', 'in', ('done', 'approved'))]}</attribute>
                </xpath>
                <xpath expr="//field[@name='order_line']" position="attributes">
                    <attribute name="attrs">{'readonly': [('custom_state', 'in', ('close', 'cancel','reject', 'approved', 'confirm'))]}</attribute>
                </xpath>
            </field>
        </record>

        <!-- Inherit purchase order tree view -->
        <record id="inherit_purchase_order_tree_view" model="ir.ui.view">
            <field name="name">purchase.order.tree.inherit</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_view_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//header//button[@name='action_create_invoice']" position="after">
                    <button string="TẠO HÓA ĐƠN"
                            class="btn btn-primary ms-md-2"
                            name="%(forlife_purchase.action_select_type_invoice_wizard)d"
                            type="action"
                            attrs="{'invisible':['|',('is_inter_company', '=', True),'&amp;',('is_done_picking', '=', False),'|',('custom_state', 'in', ('draft','confirm','reject','cancel','close'))]}"/>
                </xpath>
                <xpath expr="//header//button[@name='action_create_invoice']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='invoice_status']" position="before">
                    <field name="is_inter_company" invisible="1"/>
                    <field name="is_done_picking" invisible="1"/>
                    <field name="purchase_type" widget="badge"/>
                    <field name="custom_state" decoration-success="custom_state == 'approved'" widget="badge"/>
                </xpath>
                <xpath expr="//field[@name='invoice_status']" position="before">
                    <field name="inventory_status" attrs="{'invisible': [('purchase_type', '!=', 'product')]}" force_save="1"/>
                    <field name="date_order"/>
                </xpath>
                <field name="date_planned" position="after">
                    <field name="occasion_code_id" optional="show"/>
                    <field name="note" optional="show"/>
                </field>
            </field>
        </record>

        <record id="action_purchase_order_is_inter_company" model="ir.actions.act_window">
            <field name="name">Purchase Order Inter Company</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('purchase.purchase_order_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('purchase.purchase_order_form')})]"/>
            <field name="domain">[('is_inter_company', '=', True)]</field>
            <field name="context">{'default_is_inter_company':True}
            </field>
        </record>

        <record id="action_purchase_order_not_inter_company_cost" model="ir.actions.act_window">
            <field name="name">Đơn mua hàng nội địa</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('purchase.purchase_order_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('purchase.purchase_order_form')})]"/>
            <field name="domain">[('is_inter_company', '=', False), ('type_po_cost', '=', 'cost')]</field>
            <field name="context">{'default_is_inter_company':False, 'default_type_po_cost': 'cost'}
            </field>
        </record>

        <record id="action_purchase_order_not_inter_company_tax" model="ir.actions.act_window">
            <field name="name">Đơn mua hàng nhập khẩu</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form</field>
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('purchase.purchase_order_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('purchase.purchase_order_form')})]"/>
            <field name="domain">[('is_inter_company', '=', False), ('type_po_cost', '=', 'tax')]</field>
            <field name="context">{'default_is_inter_company':False, 'default_type_po_cost': 'tax'}
            </field>
        </record>

        <!--        Menu Is Inter Company-->
        <menuitem id="menu_purchase_order_is_inter_company" parent="purchase.menu_procurement_management"
                  action="forlife_purchase.action_purchase_order_is_inter_company" name="Purchase Order Inter Company" sequence="1"/>
        <!--        Menu Not Inter Company-->
        <menuitem id="menu_purchase_order_not_inter_company_cost" parent="purchase.menu_procurement_management"
                  action="forlife_purchase.action_purchase_order_not_inter_company_cost" name="Đơn mua hàng nội địa" sequence="2"/>
        <menuitem id="menu_purchase_order_not_inter_company_tax" parent="purchase.menu_procurement_management"
                  action="forlife_purchase.action_purchase_order_not_inter_company_tax" name="Đơn mua hàng nhập khẩu" sequence="2"/>
        <menuitem
           action="product.product_supplierinfo_type_action" id="menu_product_pricelist_action2_purchase"
           parent="purchase.menu_procurement_management" sequence="1" name="Bảng giá nhà cung cấp" />
        <menuitem id="stock.menu_action_inventory_tree" active="False"/>
        <menuitem id="stock_landed_costs.menu_stock_landed_cost" active="False"/>
        <menuitem id="stock.menu_stock_scrap" active="False"/>
        <menuitem id="studio_customization.ton_kho_ghep_bo_c3501856-3eed-4d11-bfaa-a90b1416d93b" active="False"/>
        <!--Inactive menu purchase order-->
        <menuitem id="purchase.menu_purchase_form_action" parent="purchase.menu_procurement_management" active="False"/>
        <!-- Inactive menu Request for quatation-->
        <menuitem id="purchase.menu_purchase_rfq" active="False"/>

        <record id="update_tax_and_cost_view_form" model="ir.ui.view">
            <field name="name">update_tax_and_cost_view_form</field>
            <field name="model">purchase.order</field>
            <field name="priority">1005</field>
            <field name="arch" type="xml">
                <form string="update_tax_and_cost_form" create="0" delete="0" class="padding-form-custom">
                    <header>
                        <button name="export_tax_info" icon="fa-file-excel-o" string="Tải mẫu nhập" class="oe_highlight" type="object"/>
                        <button name="%(forlife_purchase.import_tax_info_wizard_action)d" icon="fa-file-excel-o" string="Nhập thông tin thuế"
                                class="oe_highlight" type="action" context="{'default_po_id': active_id}"/>
                    </header>
                    <div class="padding-form-custom">
                        <notebook>
                            <page name="tax_info" string="Thông tin thuế">
                                <field name="exchange_rate_line_ids" widget="section_and_note_one2many" force_save="1">
                                    <tree editable="bottom" class="width-hh" create="0" delete="0">
                                        <field name="company_currency" invisible="1"/>
                                        <field name="product_id" readonly="1"/>
                                        <field name="description" readonly="1"/>
                                        <field name="company_currency" invisible="1"/>
                                        <field name="total_vnd_exchange" sum="total_vnd_exchange" readonly="1" widget="monetary" options="{'currency_field': 'company_currency'}" force_save="1"/>
                                        <field name="total_vnd_exchange_import" invisible="1"/>
                                        <field name="product_qty" readonly="1" string="Số lượng"/>
                                        <field name="import_tax"/>
                                        <field name="tax_amount" sum="tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}" readonly="1"/>
                                        <field name="tax_amount_import" invisible="1"/>
                                        <field name="special_consumption_tax"/>
                                        <field name="special_consumption_tax_amount" sum="special_consumption_tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}" readonly="1"/>
                                        <field name="special_consumption_tax_amount_import" invisible="1"/>
                                        <field name="vat_tax"/>
                                        <field name="vat_tax_amount" sum="vat_tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}" readonly="1"/>
                                        <field name="vat_tax_amount_import" invisible="1"/>
                                        <field name="total_tax_amount" sum="total_tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}" readonly="1"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Chi phí" name="product_cost">
                                <field name="is_inter_company" invisible="1"/>
                                <field name="cost_line" widget="section_and_note_one2many" mode="tree">
                                    <tree editable="bottom" class="width-hh">
                                        <field name="company_currency" invisible="1"/>
                                        <field name="product_id"/>
                                        <field name="name" readonly="1" string='Mô tả'/>
                                        <field name="currency_id"/>
                                        <field name="exchange_rate" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                        <field name="foreign_amount"/>
                                        <field name="vnd_amount" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                        <field name="actual_cost" widget="monetary" options="{'currency_field': 'currency_id'}" invisible="1" readonly="1" force_save="1"/>
                                        <field name="cost_paid" widget="monetary" options="{'currency_field': 'currency_id'}" readonly="1" force_save="1"/>
                                        <field name="is_check_pre_tax_costs"/>
                                    </tree>
                                </field>
                                <div class="xl-12 d-flex" style="justify-content: end;">
                                    <group class="xl-4">
                                    </group>
                                    <group class="xl-4">
                                    </group>
                                    <group class="xl-4">
                                        <field name="cost_total"/>
                                    </group>
                                </div>
                            </page>
                            <page string="Tổng hợp" name="synthetic">
                                <field name="purchase_synthetic_ids" widget="section_and_note_one2many" mode="tree" readonly="1" force_save="1">
                                    <tree editable="bottom" class="width-hh">
                                        <field name="currency_id" invisible="1"/>
                                        <field name="company_currency" invisible="1"/>
                                        <field name="product_id"/>
                                        <field name="description"/>
                                        <field name="product_uom" string="Đơn vị tính"/>
                                        <field name="price_unit" string="Đơn giá" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                        <field name="product_qty" sum="discounted subtotal" string="Số lượng"/>
                                        <field name="discount"/>
                                        <field name="total_vnd_amount" widget="monetary" options="{'currency_field': 'company_currency'}" sum="total_vnd_amount"/>
                                        <field name="before_tax" sum="before_tax" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                        <field name="tax_amount" sum="tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                        <field name="special_consumption_tax_amount" sum="special_consumption_tax_amount" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                        <field name="after_tax" widget="monetary" sum="after_tax" options="{'currency_field': 'company_currency'}"/>
                                        <field name="total_product" sum="total_product" widget="monetary" options="{'currency_field': 'company_currency'}"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </div>
                </form>
            </field>
        </record>
    </data>
</odoo>