<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<odoo>
    <record id="stock_exchange_form" model="ir.ui.view">
        <field name="name">stock.exchange.form</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="forlife_stock.inherit_stock_picking_for_other_export_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <field name="exchange_code" invisible="1"/>
                <field name="picking_outgoing_id" invisible="1"/>
                <button name="view_outgoing_picking" type="object" class="oe_stat_button" attrs="{'invisible':[('picking_outgoing_id', '=', False)]}">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">Outgoing</span>
                    </div>
                </button>
            </xpath>

            <xpath expr="//field[@name='reason_type_id']" position="attributes">
                <attribute name="attrs">{'invisible': [('other_export', '=', False), ('other_import', '=', False)], 'readonly': [('exchange_code', '!=', False)]}</attribute>
            </xpath>

<!--            <xpath expr="//field[@id='source_reason']" position="attributes">-->
<!--                <attribute name="attrs">{'invisible': ['|', ('other_export', '=', True), ('other_import', '=', False)], 'readonly': ['|', ('state', '=', 'done'), ('exchange_code', '!=', False)]}</attribute>-->
<!--            </xpath>-->

<!--            <xpath expr="//field[@id='source_location']" position="attributes">-->
<!--                <attribute name="attrs">{'invisible': ['|', ('exchange_code', '!=', 'outgoing'), ('other_import', '=', True)], 'readonly': ['|', ('state', '=', 'done'), ('exchange_code', '!=', False)]}</attribute>-->
<!--            </xpath>-->

<!--            <xpath expr="//field[@id='dest_reason']" position="attributes">-->
<!--                <attribute name="attrs">{'invisible': ['|', ('other_import', '=', True), ('other_export', '=', False)], 'readonly': ['|', ('state', '=', 'done'), ('exchange_code', '!=', False)]}</attribute>-->
<!--            </xpath>-->

<!--            <xpath expr="//field[@id='dest_location']" position="after">-->
<!--                <field name="location_export_id" id="export_location" attrs="{'readonly': [('state', 'in', ('confirmed', 'assigned', 'done', 'cancel'))], 'invisible': [('exchange_code', '!=', 'incoming')], 'required': [('exchange_code', '=', 'incoming')]}"/>-->
<!--            </xpath>-->

            <xpath expr="//field[@name='move_ids_without_package']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('exchange_code', '=', 'outgoing'), ('state', 'in', ('confirmed', 'assigned', 'done', 'cancel'))]}</attribute>
            </xpath>

            <xpath expr="//field[@name='amount_total']" position="before">
                <field name="price_unit" id="exchange_price_unit" force_save="1" attrs="{'column_invisible': [('parent.exchange_code', '=', False)], 'readonly': [('parent.exchange_code', 'in', ('incoming', 'outgoing'))]}"/>
            </xpath>

        </field>
    </record>

    <record id="action_forlife_stock_exchange" model="ir.actions.act_window">
        <field name="name">Forlife Stock Exchange</field>
        <field name="res_model">stock.picking</field>
        <field name="view_mode">tree,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
            (0, 0, {'view_mode': 'tree', 'view_id': ref('stock.vpicktree')}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('forlife_stock.inherit_stock_picking_for_other_export_form_view')})]"/>
        <field name="domain">[('picking_type_id.exchange_code', '=', 'incoming')]</field>
        <field name="context" eval="{'exchange_code': 'incoming'}"/>
    </record>

    <record id="forlife_stock.inherit_stock_picking_for_other_export_form_view_action" model="ir.actions.act_window">
        <field name="domain">[('other_export', '=', True), ('exchange_code', '=', False)]</field>
    </record>

    <record id="forlife_stock.inherit_stock_picking_for_other_import_form_view_action" model="ir.actions.act_window">
        <field name="domain">[('other_import', '=', True), ('exchange_code', '=', False)]</field>
    </record>
</odoo>